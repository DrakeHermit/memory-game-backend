<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  </head>
  <body>
    <h2>Socket.IO Room Test</h2>
    <button onclick="createRoom()">Create Room</button>
    <button onclick="showRooms()">Show Active Rooms</button>
    <button onclick="joinRoom()">Join Room</button>
    <button onclick="changePlayerName()">Change Player Name</button>
    <button onclick="showPlayers()">Show Players in Room</button>
    <div
      id="logs"
      style="margin-top: 20px; padding: 10px; background: #f0f0f0;"
    ></div>

    <script>
      const socket = io("http://localhost:3000");
      let currentRoomId = null;

      socket.on("connect", () => {
        log("‚úÖ Connected: " + socket.id);
      });

      socket.on("disconnect", () => {
        log("‚ùå Disconnected");
      });

      function createRoom() {
        const playerName =
          prompt("Enter your player name:") ||
          "Host" + Math.floor(Math.random() * 1000);
        log("üöÄ Creating room...");
        socket.emit("createRoom", {
          roomId: "TEST",
          maxPlayers: 3,
          theme: "numbers",
          gridSize: 4,
          playerName: playerName,
        });
      }

      function showRooms() {
        log("üìã Requesting active rooms...");
        socket.emit("getAllRooms");
      }

      socket.on("roomCreated", (data) => {
        currentRoomId = data.roomId;
        log("üéâ Room created: " + JSON.stringify(data, null, 2));
      });

      function log(msg) {
        const logs = document.getElementById("logs");
        logs.innerHTML +=
          "<div>" + new Date().toLocaleTimeString() + ": " + msg + "</div>";
        logs.scrollTop = logs.scrollHeight;
      }

      function joinRoom() {
        const roomId = prompt("Enter room ID to join:");
        if (roomId) {
          currentRoomId = roomId;
          log("üö™ Joining room: " + roomId);
          socket.emit("joinRoom", {
            roomId,
            playerName: "Player" + Math.floor(Math.random() * 1000),
          });
        }
      }

      socket.on("playerJoined", (data) => {
        log("ÔøΩÔøΩ Player joined: " + JSON.stringify(data, null, 2));
      });

      socket.on("roomError", (data) => {
        log("‚ùå Room error: " + data.message);
      });

      function changePlayerName() {
        if (!currentRoomId) {
          log("‚ùå You need to be in a room first!");
          return;
        }

        const newName = prompt("Enter new player name:");
        if (newName) {
          log("‚úèÔ∏è Changing name to: " + newName);
          socket.emit("changePlayerName", {
            roomId: currentRoomId,
            newName: newName,
          });
        }
      }

      socket.on("playerNameChanged", (data) => {
        log("‚úèÔ∏è Player name changed: " + JSON.stringify(data, null, 2));
      });

      socket.on("nameChangeError", (data) => {
        log("‚ùå Name change error: " + data.message);
      });

      function showPlayers() {
        if (!currentRoomId) {
          log("‚ùå You need to be in a room first!");
          return;
        }

        log("üë• Requesting players in room: " + currentRoomId);
        socket.emit("getGameState", {
          roomId: currentRoomId,
        });
      }

      socket.on("gameState", (data) => {
        if (data.gameState && data.gameState.players) {
          const playerNames = data.gameState.players
            .map((p) => p.name)
            .join(", ");
          log("üë• Players in room: " + playerNames);
        } else {
          log("‚ùå No game state found");
        }
      });

      socket.on("gameStateError", (data) => {
        log("‚ùå Game state error: " + data.message);
      });
    </script>
  </body>
</html>
